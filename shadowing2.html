<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEIC Part 2 Ïã§Ï†Ñ ÌõàÎ†®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css'); body { font-family: 'Pretendard', sans-serif; }</style>
</head>
<body class="bg-slate-900 text-white min-h-screen">

    <div id="start-overlay" class="fixed inset-0 z-[200] bg-slate-900 flex flex-col items-center justify-center p-8 text-center">
        <h2 class="text-3xl font-black mb-2 tracking-tighter text-indigo-400">LC Part 2 Ïã§Ï†Ñ</h2>
        <p class="text-slate-400 mb-8 font-bold text-sm">Ï†ÑÏ≤¥ 5ÌöåÎ∂Ñ ÌïôÏäµÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
        <div class="grid grid-cols-2 gap-4 w-full max-w-xs">
            <button onclick="startTest(1)" class="py-4 bg-slate-800 rounded-2xl font-black border border-slate-700 active:scale-95 transition-all">TEST 1</button>
            <button onclick="startTest(2)" class="py-4 bg-slate-800 rounded-2xl font-black border border-slate-700 active:scale-95 transition-all">TEST 2</button>
            <button onclick="startTest(3)" class="py-4 bg-slate-800 rounded-2xl font-black border border-slate-700 active:scale-95 transition-all">TEST 3</button>
            <button onclick="startTest(4)" class="py-4 bg-slate-800 rounded-2xl font-black border border-slate-700 active:scale-95 transition-all">TEST 4</button>
            <button onclick="startTest(5)" class="py-4 bg-indigo-600 rounded-2xl font-black border border-indigo-500 active:scale-95 transition-all col-span-2 mt-2 shadow-lg shadow-indigo-500/20">TEST 5 ÏãúÏûë</button>
        </div>
    </div>

    <nav class="p-6 flex justify-between items-center max-w-md mx-auto">
        <button onclick="location.href='index.html'"><i class="fas fa-home text-slate-400 text-xl"></i></button>
        <span id="progress-text" class="font-black text-indigo-400 text-lg uppercase tracking-widest italic">READY</span>
        <div class="w-4"></div>
    </nav>

    <main class="max-w-md mx-auto px-6 pb-20">
        <div id="quiz-container" class="space-y-8">
            <div id="audio-card" class="bg-white rounded-[3rem] p-12 text-center shadow-2xl relative overflow-hidden transition-all duration-300">
                <div id="playback-wave" class="absolute inset-x-0 bottom-0 h-1 bg-indigo-100 origin-left scale-x-0 transition-transform duration-100"></div>
                <button id="play-btn" onclick="handlePlay()" class="w-24 h-24 bg-indigo-600 rounded-full text-white text-4xl shadow-xl active:scale-95 flex items-center justify-center mx-auto transition-all">
                    <i class="fas fa-play ml-1"></i>
                </button>
                <p id="audio-status" class="text-slate-400 font-black text-[10px] mt-4 uppercase tracking-widest text-center">Listen & Select</p>
            </div>

            <div id="options-grid" class="grid gap-3">
                <button id="btn-0" onclick="checkAnswer(0)" class="option-btn w-full py-5 bg-slate-800 rounded-2xl font-bold text-left px-6 border border-slate-700 transition-all duration-300">
                    <span class="btn-label">(A)</span>
                </button>
                <button id="btn-1" onclick="checkAnswer(1)" class="option-btn w-full py-5 bg-slate-800 rounded-2xl font-bold text-left px-6 border border-slate-700 transition-all duration-300">
                    <span class="btn-label">(B)</span>
                </button>
                <button id="btn-2" onclick="checkAnswer(2)" class="option-btn w-full py-5 bg-slate-800 rounded-2xl font-bold text-left px-6 border border-slate-700 transition-all duration-300">
                    <span class="btn-label">(C)</span>
                </button>
            </div>
        </div>

        <div id="report-overlay" class="hidden text-center py-10 space-y-6">
            <div class="mb-8">
                <i class="fa-solid fa-square-poll-vertical text-6xl text-indigo-500 mb-4"></i>
                <h2 class="text-3xl font-black text-white mb-2 tracking-tighter">MISSION COMPLETE</h2>
                <p class="text-slate-400 font-bold">ÌãÄÎ¶∞ Î¨∏Ï†úÎ•º ÌôïÏù∏ÌïòÍ≥† Î≥µÏäµÌïòÏÑ∏Ïöî.</p>
            </div>

            <div class="bg-slate-800 rounded-[2.5rem] p-8 mb-8 border border-slate-700 shadow-xl">
                <p class="text-indigo-400 font-black text-xs uppercase tracking-[0.2em] mb-4">Wrong Questions</p>
                <div id="wrong-list-display" class="text-2xl font-black text-white leading-relaxed flex flex-wrap justify-center gap-2">
                    </div>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <button id="review-start-btn" onclick="startReview()" class="w-full py-5 bg-indigo-600 rounded-2xl font-black text-lg shadow-xl shadow-indigo-500/20 active:scale-95 transition-all">
                    <i class="fa-solid fa-rotate-right mr-2"></i> ÌãÄÎ¶∞ Î¨∏Ï†ú Ïû¨ÌïôÏäµ
                </button>
                <button onclick="finishAll()" class="w-full py-5 bg-slate-800 border border-slate-700 rounded-2xl font-black text-lg text-slate-300 active:scale-95 transition-all">
                    <i class="fa-solid fa-door-open mr-2"></i> ÌïôÏäµ Ï¢ÖÎ£å (Í∏∞Î°ù Ï†ÄÏû•)
                </button>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBThrCtBNJuVcfPD3Vm6XvPD7McT5JJsN8", 
            authDomain: "eduthot-fb088.firebaseapp.com", 
            projectId: "eduthot-fb088", 
            storageBucket: "eduthot-fb088.firebasestorage.app", 
            messagingSenderId: "919552710378", 
            appId: "1:919552710378:web:7ba72ea2d195e092f8a993" 
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const generateData = (arr) => arr.map((item, index) => ({ id: 7 + index, correct: item.c, script: item.s, options: item.o }));

        const testBank = {
            1: generateData([
                {c:1, s:"How old is this building?", o:["To ship some materials.", "About ten years old.", "Company offices, I think."]},
                {c:2, s:"Can you come to my jazz performance tonight?", o:["I'm sorry I was late for the meeting.", "Mostly just local musicians.", "Sure, I'll be there!"]},
                {c:2, s:"Which apartment submitted a work order?", o:["It's what you did for a living.", "Submit your assignment here.", "It came from the tenants in B23."]},
                {c:0, s:"Will you contact the vendor about changing our delivery date?", o:["Of course, I'll take care of it.", "An e-mail receipt.", "Could I get change for a dollar?"]},
                {c:2, s:"Why was the maintenance worker here?", o:["No, he didn't.", "From three o'clock until four.", "Because a light needed to be fixed."]},
                {c:2, s:"Did management make a hiring decision yet?", o:["Put it on the highest shelf.", "The personnel department.", "Yes, they chose Jacob Borgman."]},
                {c:2, s:"Do you want to eat here in our cafeteria or go out?", o:["He went there yesterday.", "Well, maybe a sandwich.", "Lets eat here."]},
                {c:1, s:"Didn't you e-mail the employment contract to Mr. Patel yesterday?", o:["Yes, I would agree.", "No, I'll send it now.", "Check the employee manual."]},
                {c:0, s:"Our division's picnic is this Saturday, right?", o:["There's a lot of rain in the forecast.", "Sure, I like salad.", "At the end of this corridor."]},
                {c:0, s:"Would you like coffee or tea?", o:["Just water, please.", "For a few dollars more.", "A fifteen-minute break."]},
                {c:0, s:"We achieved our sales targets this month.", o:["That's excellent news!", "A few times a day.", "To the end of April."]},
                {c:2, s:"How often do you travel for your job?", o:["It turned out well.", "Yes, I did find one.", "About once a month."]},
                {c:1, s:"We should hike the Wildflower Trail today.", o:["This seat is available.", "I didn't bring boots.", "At the visitors' center."]},
                {c:2, s:"You've booked a hotel in London, haven't you?", o:["Very enjoyable, thanks.", "He usually takes the train.", "Yes, I made a reservation last week."]},
                {c:0, s:"Are there any tickets left for tonight's concert?", o:["It's sold out.", "He's a concert violinist.", "They already left."]},
                {c:1, s:"Haven't you used this software before?", o:["Can I take your order?", "I haven't had the chance.", "About 40 dollars."]},
                {c:2, s:"When is the new blender going to be released?", o:["Only with fruits and vegetables.", "In the kitchen cabinet.", "The prototype is still being tested."]},
                {c:0, s:"Who's picking up our clients at the airport?", o:["They decided to drive.", "At terminal 2.", "It's a marketing position."]},
                {c:2, s:"Where are the red roses that came in this morning?", o:["About three liters of water.", "No, I didn't check out the sale.", "I needed some for a large bouquet."]},
                {c:0, s:"This film has been nominated for several awards.", o:["Why don't we go see it?", "After the announcement.", "He made a great speech."]},
                {c:1, s:"Who's interested in starting a car pool program?", o:["Thanks, but I can't swim.", "Clara's already organizing one.", "It's a very interesting article."]},
                {c:0, s:"Where will I teach my workshop this month?", o:["We just sent an e-mail to all instructors.", "Five to seven months.", "Yes, it's a beautiful building."]},
                {c:2, s:"Why are we moving these sweaters to the back of the store?", o:["In the new shopping mall.", "Yes, they come in other colors.", "Our spring merchandise is arriving soon."]},
                {c:2, s:"Would you be interested in working on some of these contracts?", o:["Thank you for meeting me.", "A contact lens prescription.", "I have very limited time."]},
                {c:1, s:"What type of job are you looking for?", o:["No, at ten A.M.", "I really like working with computers.", "Just a r√©sum√© is needed."]}
            ]),
            2: generateData([
                {c:0, s:"Have the machines on the factory floor been cleaned?", o:["No, not yet.", "Ifs in the shipping container.", "I just put it in the trash bin."]},
                {c:0, s:"How much will the budget increase next year?", o:["About 10 percent.", "Three hours, I think.", "At the bank's main branch."]},
                {c:1, s:"You're going to water the plants before you leave, aren't you?", o:["I walked the whole way.", "Yes, right after lunch.", "In the breakroom."]},
                {c:1, s:"Aren't you going to schedule an eye doctor appointment?", o:["Those glasses look nice on you.", "I already scheduled one.", "The seminar is three days long."]},
                {c:2, s:"I'm going to try to fix this printer.", o:["You're right, it doesn't fit.", "Double-sided copies.", "Are you sure it can be repaired?"]},
                {c:2, s:"What should we do with these brochures?", o:["A trip to the seashore.", "Yes, I found it already.", "111 leave them at the front desk."]},
                {c:1, s:"Has the policy meeting been rescheduled?", o:["We have lots of desk calendar designs.", "Yes, its happening tomorrow instead.", "This soup I ordered is delicious."]},
                {c:0, s:"Why don't we stop by the office cafeteria on our way to the workshop?", o:["Sure, we have time for that.", "A full-service buffet.", "The topic is professional networking."]},
                {c:1, s:"Have you tried our famous pasta dish?", o:["We need a table for five.", "Yes, it was delicious.", "111 try to make it on time."]},
                {c:1, s:"Who's the opening act at tonight's concert?", o:["Could you turn up the volume?", "A jazz singer from France.", "The position has been filled."]},
                {c:2, s:"When do the product demonstrations start?", o:["The schedule was e-mailed last Friday.", "Some innovative features.", "In room 202, I think."]},
                {c:2, s:"I tried updating the Web site, but it didn't work.", o:["That date works for me.", "Usually our online reviews.", "Just send me the changes you want."]},
                {c:1, s:"Did you hire a new welding specialist?", o:["The parts back-ordered.", "Yes, he starts tomorrow.", "No, it should be higher."]},
                {c:2, s:"How was the color palette for the lobby chosen?", o:["Blue and orange.", "It was fine, thanks.", "I wasn't involved."]},
                {c:1, s:"When are we ordering more supplies for the office?", o:["In the storage closet.", "Next week on Monday.", "The new desk looks great!"]},
                {c:0, s:"The battery for the water p-rip is going to be solar powered, right?", o:["We're still in the planning stages.", "A hundred and forty dollars per year.", "Yes, I'd love a glass of water."]},
                {c:1, s:"Where can I buy a charger for this laptop?", o:["Around three o'clock.", "I can order one for you.", "A limited return policy."]},
                {c:0, s:"Do I need to reserve a meeting room?", o:["Yes, let me show you how.", "The service is good.", "My slide presentation."]},
                {c:1, s:"When's the new department director supposed to start?", o:["Ifs an hour long.", "Ms. Pavlova isn't retiring for several weeks.", "No, that department's upstairs."]},
                {c:2, s:"Should I deliver these pizzas, or will you?", o:["No thanks‚ÄîI'm not hungry.", "Ten dollars for two.", "They're being picked up."]},
                {c:1, s:"This month's shipment schedule has been revised.", o:["I couldn't find them either.", "Which dates have been changed?", "Two dollars per pound."]},
                {c:0, s:"How much will the repairs cost?", o:["The work is covered under the warranty plan.", "Yes, it's also available in red.", "In about two weeks."]},
                {c:2, s:"Why don't we provide more samples of the wallpaper patterns?", o:["The newspaper is delivered daily.", "An interior design course.", "There are plenty in the binders."]},
                {c:0, s:"Can you give me a tour of the property this afternoon?", o:["Sorry, I won't have time until tomorrow.", "It has a very modern design.", "A house on Maple Street."]},
                {c:0, s:"Who's scheduled to test the product today?", o:["We're waiting for confirmation.", "Ifs a great album, right?", "Ab=jt six weeks ago."]}
            ]),
            3: generateData([
                {c:0, s:"Why is there no flour on the shelf?", o:["Because it's out of stock.", "Those roses smell nice.", "No, the other cake."]},
                {c:0, s:"When will the catering company arrive?", o:["At four o'clock.", "Thats a delicious flavor.", "Many vegetarian options."]},
                {c:2, s:"When's the meeting scheduled to start?", o:["At a networking event.", "I started this job six years ago.", "Right after lunch."]},
                {c:1, s:"How much will the repairs cost?", o:["I have two pairs of shoes.", "Around 200 dollars.", "The restaurant downtown."]},
                {c:1, s:"You went to the dentist this morning, didn't you?", o:["Oh, I‚Äôve already had breakfast.", "Yes, for an annual checkup.", "Let‚Äôs take the bus."]},
                {c:0, s:"Where should we put the new printer?", o:["In the corner by the stairs.", "The third page of the document.", "A reusable ink cartridge."]},
                {c:2, s:"What type of plant do you have in your office?", o:["Whenever I sit at my desk.", "Thanks‚ÄîI just bought it.", "One that doesn't require much water."]},
                {c:1, s:"There was a sale at the furniture store.", o:["No, it wasn't in storage.", "Did you buy anything?", "Some old receipts."]},
                {c:0, s:"Can you show me how to submit a tech help ticket?", o:["Let me send you the link.", "A broken power cable.", "No, over ten minutes."]},
                {c:0, s:"Where is the power button on this device?", o:["I've never used that model before.", "Ten euros per hour.", "We charge more for color photographs."]},
                {c:1, s:"Do you want to take a walk now, or would later be better?", o:["A nearby lake.", "I'm free to walk now.", "No, I don't use a fitness tracker."]},
                {c:1, s:"I ordered some new equipment for the factory.", o:["The news program on Channel Ten.", "Great‚ÄîI can't wait to use it.", "The car dealership."]},
                {c:0, s:"There's a nice place to rent on Mercer Street.", o:["I just renewed my current lease.", "It was a great show.", "A standard rental application."]},
                {c:2, s:"Is the heating system working?", o:["Yes, that's my Web site.", "A five-kilometer run.", "I just called maintenance."]},
                {c:2, s:"Isn't the roadwork in front of city hall finished yet?", o:["I just finished my conference presentation.", "A lot of traffic in the evening.", "No, they still have another month to go."]},
                {c:0, s:"Who will lead the new-employee training today?", o:["we‚Äôre using a recorded video.", "yes, right after lunch.", "classroom 124"]},
                {c:2, s:"Is the safety inspection scheduled for this month or next month?", o:["I thought I saved the file.", "The factory supervisor.", "It's this Wednesday."]},
                {c:0, s:"When is the harvest festival taking place?", o:["It's a week from tomorrow.", "Sure, I can take it.", "The park next to the art museum."]},
                {c:1, s:"Was your new laptop expensive?", o:["Do you have a new password?", "I had a discount coupon.", "On top of the cabinet."]},
                {c:2, s:"Why don't we go on our camping trip next weekend?", o:["Yes, that table lamp is quite nice.", "Should we go left or right?", "I have a performance scheduled with my band."]},
                {c:1, s:"The workshop for this afternoon was postponed, wasn't it?", o:["At the post office.", "I haven't checked my e-mail.", "A ticket for two o'clock, please."]},
                {c:2, s:"How were our production figures last month?", o:["they produce electric cars.", "nice o‚Äôclock in the morning.", "we were closed down for a week."]},
                {c:2, s:"When can I see the speech therapist?", o:["a one-hour session.", "just a microphone.", "how about tomorrow afternoon?"]},
                {c:1, s:"Aren‚Äôt you picking up the clients from the airport?", o:["a product demonstration.", "no, I believe Tomoko is doing that.", "he prefers an aisle seat."]},
                {c:2, s:"How was your morning client meeting?", o:["it‚Äôs great to meet you", "no, over in conference room two", "the contact is now officially signed"]}
            ]),
            4: generateData([
                {c:0, s:"Does the shop open on Sundays?", o:["Yes, at one o'clock.", "Because we drove.", "I'd like to return this item, please."]},
                {c:1, s:"Where did these oranges come from?", o:["Here's a basket you can use.", "From a supplier in California.", "That umbrella is a nice color."]},
                {c:1, s:"Should I make the dinner reservation for Friday or Saturday?", o:["The Beachside Bistro.", "Saturday is better.", "A large plate of pasta."]},
                {c:0, s:"Will Dr. Ivanova be late today?", o:["No, you shouldn't have to wait long.", "It's just under the desk.", "Sure, I can do that for you."]},
                {c:2, s:"Aren't there locker rooms at this gym?", o:["These socks are quite comfortable.", "She teaches an exercise class.", "Yes, they're on the lower floor."]},
                {c:0, s:"Who needs a copy of my safety training certificate?", o:["Maksim does.", "You can hang your vest on that hook.", "No, I'm certain about that."]},
                {c:2, s:"Could you phone Mr. Feras and let him know we're in the hotel lobby?", o:["Thank you, it was just renovated.", "A free continental breakfast.", "Yes, of course."]},
                {c:2, s:"Where does she sell her handmade jewelry?", o:["They'll give you a discount.", "A pair of earrings.", "At a store in the city center."]},
                {c:0, s:"You're taking a business class in the afternoon, aren't you?", o:["Actually, its in the morning.", "That office is on the corner.", "I have the train schedule here."]},
                {c:2, s:"Could I see some sample floral arrangements before I order?", o:["It's for an award ceremony.", "A charge for expedited delivery.", "Certainly, I have some right here."]},
                {c:1, s:"Don't you want to buy the black sofa?", o:["Some customer reviews.", "We already have one.", "I take my coffee with sugar."]},
                {c:0, s:"Do you have this jacket in a larger size?", o:["Oh, I'm not a sales associate.", "Pve read the information packet.", "A very large uniform."]},
                {c:2, s:"Where did you first learn about the job opening?", o:["Are there any outdoor tables available?", "The door to the building is still open.", "I read an online newspaper every morning."]},
                {c:2, s:"Should I bring anything to the meeting?", o:["Probably in the conference room.", "They were hired by our manager.", "Do we have enough handouts?"]},
                {c:0, s:"What was the total charge for the hotel stay?", o:["I'd have to look at the receipt.", "The fitness center is across from the reception desk.", "I'll be eating breakfast in my room."]},
                {c:0, s:"Why did you pursue a career in video game design?", o:["Because I have a talent for it.", "This is my new laptop.", "Ifs on the other shelf."]},
                {c:2, s:"I'd like to attend the job fair next month.", o:["The speech was inspiring.", "Tunji updated the memo.", "Registration closed yesterday."]},
                {c:2, s:"Hasn't anyone called you back for the second interview yet?", o:["A new phone number.", "Yes, any available position.", "I'm still waiting."]},
                {c:2, s:"How many tickets do we need for tonight's concert?", o:["The theater is on Johnson Avenue.", "At seven thirty sharp.", "I'll buy mine at the door."]},
                {c:1, s:"When are they going to decide who to hire?", o:["A much higher salary.", "A lot of good r√©sum√©s have come in.", "In the building across the street."]},
                {c:2, s:"I had a chance to look over the contract this morning.", o:["Their contact information.", "Early next week.", "What did you think of it?"]},
                {c:0, s:"How are the database updates coming along?", o:["I‚Äôve been really busy with the Williams account", "some customer addresses", "she arrives on Wednesday"]},
                {c:2, s:"When can I bring these boxes into the warehouse?", o:["the in a package", "thanks, I just bought it", "we‚Äôll need to clear some space"]},
                {c:1, s:"The market on fifth street is closed for a week.", o:["some new clothes", "is there another one nearby?", "the price has been marked down"]},
                {c:1, s:"Does the company pay for professional-development courses?", o:["Insook helped develop a new product", "we do have a significant budget surplus", "No information"]}
            ]),
            5: generateData([
                {c:0, s:"There's a meeting in the conference room soon, right?", o:["Yes, it's for the whole department.", "No, put it in the closet.", "The rent is too high."]},
                {c:2, s:"Why hasn't the mural in the lobby been painted yet?", o:["Red and yellow.", "Please pick up the ladder.", "Because the artist is out of town."]},
                {c:2, s:"Do you prefer writing in the morning or the afternoon?", o:["My publisher requested edits.", "Thanks for providing a solution.", "Mornings are usually better for me."]},
                {c:1, s:"I suggest we paint the waiting room light blue.", o:["Doctor Park has an opening at three.", "That's a good idea.", "I prefer the red jacket."]},
                {c:1, s:"Did you know that the music school is closed on Sundays?", o:["Forty dollars an hour.", "No, I didn't know that.", "I saw the piano recital."]},
                {c:0, s:"How do I find the office manager?", o:["The receptionist would know.", "Desk lamps and headsets.", "Twelve euros."]},
                {c:1, s:"When did you place the order for the lumber?", o:["Yes, it's a great place for hiking.", "It's out of stock right now.", "The warehouse on William Street."]},
                {c:2, s:"Where is the new packaging machine?", o:["Ten packages a minute.", "We met last Thursday.", "We decided to keep the old one."]},
                {c:1, s:"111 be out of the office this afternoon.", o:["An awfully long commute.", "OK‚ÄîI'll update your schedule.", "It's right down the hallway."]},
                {c:0, s:"Are you taking a vacation once this project is over?", o:["Yes‚ÄîI'm planning a trip to Barcelona.", "This is your second time, isn't it?", "Blueprints for a high-rise building."]},
                {c:1, s:"Let's post the sales report to our team's Web page.", o:["We're sharing a taxi to the airport.", "I can do that.", "A recent hiring decision."]},
                {c:0, s:"Which airline are you planning on using?", o:["The usual one.", "A one-way ticket.", "Yes, you can use mine."]},
                {c:1, s:"Where's this shipment of parts being sent?", o:["Around five thirty this evening.", "To the assembly plant in Dublin.", "Just half the order."]},
                {c:2, s:"Who paid for lunch?", o:["I just ate.", "It closes at five.", "Alberto did."]},
                {c:1, s:"How many employees work in your department?", o:["I don't mind taking notes at the meeting.", "A couple dozen, I think.", "It's seven meters long."]},
                {c:0, s:"We should leave for our training course soon, shouldn't we?", o:["We still have a few minutes.", "There's a map on the wall.", "Two sessions per day."]},
                {c:1, s:"Isn't there a limit on travel expenses?", o:["To fix the vending machine.", "One hundred dollars per day.", "Next to the travel agency."]},
                {c:2, s:"When should I tell the director that I'm interested in the management position?", o:["Yes, we're extending our business hours.", "Didn't Andrey direct the play?", "I'm not on the hiring team."]},
                {c:2, s:"The layout of the footwear department has changed.", o:["There's a charging station in the cafe.", "Yes, a three-bedroom apartment.", "The store has a new manager."]},
                {c:1, s:"Can you look at this month's revenue report?", o:["The news program is informative.", "I have some free time tomorrow afternoon.", "He started that position in July."]},
                {c:2, s:"Why haven't the windows been replaced yet?", o:["Not too much wind, no.", "Look in the filing cabinet.", "Did you see the cost estimate?"]},
                {c:2, s:"Isn‚Äôt you suitcase going to be heavier than the permitted weight?", o:["the building permit arrived today", "there are seats in the lobby", "I‚Äôll have to pay a little bit extra."]},
                {c:0, s:"Who manufactures the engines for our machines?", o:["Koji is in charge of supplier contracts", "I‚Äôm sorry- the storage room is full", "that‚Äôs cargo airplane"]},
                {c:0, s:"Should we meet at the department store on fifth street or the one on Grover Lane?", o:["let‚Äôs ask Patricia first", "no, I don‚Äôt mind", "how much does it cost?"]},
                {c:2, s:"Which band is playing at the club tonight?", o:["there‚Äôs always a comedy show on Thursday night", "yes, I‚Äôve played the piano for many years", "their number one hit"]}
            ])
        };

        let currentTestNum = 1;
        let mainQueue = [];
        let wrongQueue = [];
        let isReviewMode = false;
        let currentIdx = 0;
        let audio = new Audio();

        // ÌÄ¥Ï¶à ÏãúÏûë Ìï®Ïàò
        window.startTest = function(num) {
            currentTestNum = num;
            mainQueue = testBank[num];
            if(!mainQueue || mainQueue.length === 0) { alert("Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§."); return; }
            wrongQueue = [];
            isReviewMode = false;
            currentIdx = 0;
            document.getElementById('start-overlay').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('report-overlay').classList.add('hidden');
            loadQuestion();
        };

        // Î¨∏Ï†ú Î°úÎìú Ìï®Ïàò
        function loadQuestion() {
            audio.pause();
            const list = isReviewMode ? wrongQueue : mainQueue;
            const data = list[currentIdx];
            
            document.getElementById('progress-text').innerText = isReviewMode ? `REVIEW Q.${data.id}` : `TEST ${currentTestNum} Q.${data.id}`;
            document.getElementById('play-btn').innerHTML = '<i class="fas fa-play ml-1"></i>';
            document.getElementById('audio-status').innerText = "Click Play";
            document.getElementById('playback-wave').style.transform = 'scaleX(0)';
            
            [0, 1, 2].forEach(i => {
                const btn = document.getElementById(`btn-${i}`);
                btn.className = "option-btn w-full py-5 bg-slate-800 rounded-2xl font-bold text-left px-6 border border-slate-700 transition-all duration-300";
                btn.disabled = false;
                btn.querySelector('.btn-label').innerText = `(${String.fromCharCode(65+i)})`;
            });
            
            const tNum = currentTestNum.toString().padStart(2, '0');
            const qNum = data.id.toString().padStart(2, '0');
            audio.src = `audio/Test_${tNum}-${qNum}.mp3`;
        }

        // Ïò§ÎîîÏò§ Ïû¨ÏÉù Ï≤òÎ¶¨
        window.handlePlay = function() {
            audio.currentTime = 0;
            audio.play().catch(e => { document.getElementById('audio-status').innerText = "File Not Found"; });
            document.getElementById('play-btn').innerHTML = '<i class="fas fa-volume-up"></i>';
            document.getElementById('audio-status').innerText = "Playing...";
            audio.ontimeupdate = () => {
                const progress = audio.currentTime / audio.duration || 0;
                document.getElementById('playback-wave').style.transform = `scaleX(${progress})`;
            };
            audio.onended = () => {
                document.getElementById('play-btn').innerHTML = '<i class="fas fa-redo-alt"></i>';
                document.getElementById('audio-status').innerText = "Select Answer";
            };
        };

        // Ï†ïÎãµ Ï≤¥ÌÅ¨ Ìï®Ïàò
        window.checkAnswer = function(choice) {
            const list = isReviewMode ? wrongQueue : mainQueue;
            const data = list[currentIdx];
            [0,1,2].forEach(i => document.getElementById(`btn-${i}`).disabled = true);

            if (choice === data.correct) {
                const btn = document.getElementById(`btn-${choice}`);
                btn.classList.replace('bg-slate-800', 'bg-green-600');
                btn.classList.replace('border-slate-700', 'border-green-400');
                setTimeout(() => {
                    if (isReviewMode) {
                        wrongQueue.splice(currentIdx, 1);
                        if (wrongQueue.length === 0) finishAll(); // Î™®Îì† Î≥µÏäµ ÏôÑÎ£å Ïãú
                        else {
                            if (currentIdx >= wrongQueue.length) currentIdx = 0;
                            loadQuestion();
                        }
                    } else {
                        currentIdx++;
                        if (currentIdx >= mainQueue.length) showReport();
                        else loadQuestion();
                    }
                }, 800);
            } else {
                const btn = document.getElementById(`btn-${choice}`);
                btn.classList.replace('bg-slate-800', 'bg-rose-600');
                btn.classList.replace('border-slate-700', 'border-rose-400');
                btn.querySelector('.btn-label').innerText = data.options[choice];
                
                if (!isReviewMode) {
                    if(!wrongQueue.find(i => i.id === data.id)) wrongQueue.push(data);
                }
                setTimeout(() => {
                    [0,1,2].forEach(i => document.getElementById(`btn-${i}`).disabled = false);
                    handlePlay();
                }, 1500);
            }
        };

        // Í≤∞Í≥º Î¶¨Ìè¨Ìä∏ Ï∂úÎ†• Ìï®Ïàò
        function showReport() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('report-overlay').classList.remove('hidden');
            
            const listDisplay = document.getElementById('wrong-list-display');
            listDisplay.innerHTML = '';

            if (wrongQueue.length === 0) {
                listDisplay.innerHTML = '<span class="text-emerald-400">Perfect! Î™®Îì† Î¨∏Ï†úÎ•º ÎßûÌòîÏäµÎãàÎã§. üéâ</span>';
                document.getElementById('review-start-btn').classList.add('hidden');
            } else {
                wrongQueue.forEach(q => {
                    const span = document.createElement('span');
                    span.className = "px-4 py-2 bg-rose-500/20 text-rose-500 rounded-xl border border-rose-500/30 text-sm font-bold";
                    span.innerText = `Q.${q.id}`;
                    listDisplay.appendChild(span);
                });
                document.getElementById('review-start-btn').classList.remove('hidden');
            }
        }

        // Î≥µÏäµ Î™®Îìú ÏãúÏûë
        window.startReview = function() {
            isReviewMode = true; 
            currentIdx = 0;
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('report-overlay').classList.add('hidden');
            loadQuestion();
        };

        // ÏµúÏ¢Ö Ï¢ÖÎ£å Î∞è Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        window.finishAll = async function() {
            const user = JSON.parse(localStorage.getItem('toeic_user'));
            if (user) {
                try {
                    const finalScore = mainQueue.length - wrongQueue.length;
                    // Firebase Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ° (Manager_Results Ïª¨Î†âÏÖò)
                    await setDoc(doc(db, "Manager_Results", `${user.userId}_Part2_${Date.now()}`), {
                        student: user.userName,
                        studentClass: user.userClass,
                        unit: `LC_Part2_Test${currentTestNum}`,
                        score: finalScore,
                        total: mainQueue.length,
                        timestamp: serverTimestamp()
                    });
                    alert("ÌïôÏäµ Í≤∞Í≥ºÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.");
                } catch (e) {
                    console.error("Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ï§ë Ïò§Î•ò Î∞úÏÉù:", e);
                }
            }
            location.href = 'index.html';
        };
    </script>
</body>
</html>