<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadowing Part 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; background-color: #0f172a; color: white; }
    </style>
</head>
<body class="min-h-screen">
    <div class="max-w-md mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-12">
            <button onclick="location.href='index.html'" class="text-slate-400 hover:text-white transition-colors">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h1 id="test-title" class="text-2xl font-black tracking-tighter italic text-white uppercase">TEST 01</h1>
            <div class="w-8"></div>
        </header>

        <div class="bg-slate-800 rounded-[3rem] shadow-2xl p-10 text-center border border-slate-700">
            <p id="q-label" class="text-indigo-400 font-bold text-xs uppercase tracking-widest mb-10 italic">Question 07</p>
            
            <div class="mb-12">
                <button id="play-audio-btn" class="w-24 h-24 bg-indigo-600 text-white rounded-full shadow-xl hover:bg-indigo-500 active:scale-90 transition-all duration-300">
                    <i class="fas fa-play text-3xl ml-1"></i>
                </button>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <button onclick="handleChoice('a')" class="bg-slate-700 py-6 rounded-[2rem] text-white font-black text-xl hover:bg-slate-600 border-2 border-transparent active:scale-95 transition-all">A</button>
                <button onclick="handleChoice('b')" class="bg-slate-700 py-6 rounded-[2rem] text-white font-black text-xl hover:bg-slate-600 border-2 border-transparent active:scale-95 transition-all">B</button>
                <button onclick="handleChoice('c')" class="bg-slate-700 py-6 rounded-[2rem] text-white font-black text-xl hover:bg-slate-600 border-2 border-transparent active:scale-95 transition-all">C</button>
            </div>

            <div class="mt-10 text-slate-500 font-bold tracking-tighter">
                <span id="current-step" class="text-indigo-400">1</span> / <span id="total-step">25</span>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBThrCtBNJuVcfPD3Vm6XvPD7McT5JJsN8",
            authDomain: "eduthot-fb088.firebaseapp.com",
            projectId: "eduthot-fb088",
            storageBucket: "eduthot-fb088.firebasestorage.app",
            messagingSenderId: "919552710378",
            appId: "1:919552710378:web:7ba72ea2d195e092f8a993"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // âœ… PDF ì •ë‹µ ëŒ€ì¡° ì™„ë£Œ (7~31ë²ˆ)
        const allTestAnswers = {
            "1": ['b','c','c','a','c','c','c','b','a','a','a','c','b','c','a','b','a','c','a','c','a','b','a','c','b'],
            "2": ['b','a','c','c','b','b','a','c','b','b','a','c','c','a','b','a','c','b','a','c','b','a','b','c','b'],
            "3": ['a','c','b','b','a','b','c','b','a','c','a','b','b','c','a','b','c','a','b','a','c','b','a','c','a'],
            "4": ['b','a','b','c','b','a','c','b','a','c','b','a','b','c','a','c','b','a','b','c','b','a','c','a','b'],
            "5": ['c','a','b','c','a','b','b','a','c','a','b','c','a','b','a','c','b','a','c','b','a','b','c','a','b']
        };

        let currentTestNum = localStorage.getItem('selectedTestNum') || "1";
        const answers = allTestAnswers[currentTestNum];

        let idx = 0;
        const player = new Audio();
        
        const label = document.getElementById('q-label');
        const currentStepEl = document.getElementById('current-step');
        const totalStepEl = document.getElementById('total-step');
        const testTitleEl = document.getElementById('test-title');

        function initQuiz() {
            testTitleEl.innerText = `TEST 0${currentTestNum}`;
            const qNum = idx + 7;
            label.innerText = `Question ${qNum.toString().padStart(2, '0')}`;
            currentStepEl.innerText = idx + 1;
            totalStepEl.innerText = answers.length;
            
            // ðŸ”Š ìŒì› íŒŒì¼ ê²½ë¡œ ì„¤ì • (ê°€ìž¥ ì•ˆì •ì ì´ì—ˆë˜ ë°©ì‹)
            player.src = "audio/p2_" + qNum.toString().padStart(2, '0') + ".mp3";
            player.load(); // íŒŒì¼ ë¯¸ë¦¬ ë¡œë“œ
        }

        // ìž¬ìƒ ë²„íŠ¼: ì•„ê¹Œ ì„±ê³µí–ˆë˜ ê°€ìž¥ ë‹¨ìˆœí•œ ë¡œì§ìœ¼ë¡œ ë³µêµ¬
        document.getElementById('play-audio-btn').onclick = () => {
            player.play();
        };

        window.handleChoice = async (choice) => {
            if (choice === answers[idx]) {
                idx++;
                if (idx < answers.length) {
                    initQuiz();
                } else {
                    await saveRecord();
                }
            } else {
                alert("ë‹¤ì‹œ ë“¤ì–´ë³´ì„¸ìš”! âŒ");
            }
        };

        async function saveRecord() {
            const user = JSON.parse(localStorage.getItem('toeic_user'));
            if (user) {
                try {
                    await setDoc(doc(db, "Winter_Users", user.userId), {
                        userId: user.userId, userName: user.userName, userClass: user.userClass,
                        passedShadowing: arrayUnion(`Test ${currentTestNum} ì™„ë£Œ`),
                        lastUpdate: new Date().toISOString()
                    }, { merge: true });
                    alert(`ðŸ† TEST ${currentTestNum} ì™„ë£Œ!`);
                    location.href = "index.html";
                } catch (e) { console.error(e); }
            }
        }

        window.onload = initQuiz;
    </script>
</body>
</html>