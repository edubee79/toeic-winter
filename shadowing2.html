<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEIC Part 2 Ïã§Ï†Ñ ÌõàÎ†®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css'); body { font-family: 'Pretendard', sans-serif; }</style>
</head>
<body class="bg-slate-900 text-white min-h-screen">

    <div id="start-overlay" class="fixed inset-0 z-[200] bg-slate-900 flex flex-col items-center justify-center p-8 text-center">
        <h2 class="text-3xl font-black mb-2 tracking-tighter text-indigo-400">LC Part 2 Ïã§Ï†Ñ</h2>
        <p class="text-slate-400 mb-8 font-bold text-sm">Ï†ÑÏ≤¥ 5ÌöåÎ∂Ñ ÌïôÏäµÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
        <div class="grid grid-cols-2 gap-4 w-full max-w-xs">
            <button onclick="startTest(1)" class="py-4 bg-slate-800 rounded-2xl font-black border border-slate-700 active:scale-95 transition-all">TEST 1</button>
            <button onclick="startTest(2)" class="py-4 bg-slate-800 rounded-2xl font-black border border-slate-700 active:scale-95 transition-all">TEST 2</button>
            <button onclick="startTest(3)" class="py-4 bg-slate-800 rounded-2xl font-black border border-slate-700 active:scale-95 transition-all">TEST 3</button>
            <button onclick="startTest(4)" class="py-4 bg-slate-800 rounded-2xl font-black border border-slate-700 active:scale-95 transition-all">TEST 4</button>
            <button onclick="startTest(5)" class="py-4 bg-indigo-600 rounded-2xl font-black border border-indigo-500 active:scale-95 transition-all col-span-2 mt-2 shadow-lg shadow-indigo-500/20">TEST 5 ÏãúÏûëÌïòÍ∏∞</button>
        </div>
    </div>

    <nav class="p-6 flex justify-between items-center max-w-md mx-auto">
        <button onclick="location.href='index.html'"><i class="fas fa-home text-slate-400 text-xl"></i></button>
        <span id="progress-text" class="font-black text-indigo-400 text-lg uppercase tracking-widest italic">READY</span>
        <div class="w-4"></div>
    </nav>

    <main class="max-w-md mx-auto px-6 pb-20">
        <div id="quiz-container" class="space-y-8">
            <div id="audio-card" class="bg-white rounded-[3rem] p-12 text-center shadow-2xl relative overflow-hidden transition-all duration-300">
                <div id="playback-wave" class="absolute inset-x-0 bottom-0 h-1 bg-indigo-100 origin-left scale-x-0 transition-transform duration-100"></div>
                <button id="play-btn" onclick="handlePlay()" class="w-24 h-24 bg-indigo-600 rounded-full text-white text-4xl shadow-xl active:scale-95 flex items-center justify-center mx-auto transition-all">
                    <i class="fas fa-play ml-1"></i>
                </button>
                <p id="audio-status" class="text-slate-400 font-black text-[10px] mt-4 uppercase tracking-widest text-center">Listen & Select</p>
            </div>

            <div id="options-grid" class="grid gap-3">
                <button id="btn-0" onclick="checkAnswer(0)" class="option-btn w-full py-5 bg-slate-800 rounded-2xl font-bold text-left px-6 border border-slate-700 transition-all duration-300">
                    <span class="btn-label">(A)</span>
                </button>
                <button id="btn-1" onclick="checkAnswer(1)" class="option-btn w-full py-5 bg-slate-800 rounded-2xl font-bold text-left px-6 border border-slate-700 transition-all duration-300">
                    <span class="btn-label">(B)</span>
                </button>
                <button id="btn-2" onclick="checkAnswer(2)" class="option-btn w-full py-5 bg-slate-800 rounded-2xl font-bold text-left px-6 border border-slate-700 transition-all duration-300">
                    <span class="btn-label">(C)</span>
                </button>
            </div>
        </div>

        <div id="review-overlay" class="hidden text-center py-20 space-y-6">
            <h3 class="text-4xl font-black text-rose-500 italic">REVIEW</h3>
            <p class="text-slate-400 font-bold">ÌãÄÎ¶∞ Î¨∏Ï†úÎ•º Îã§Ïãú ÏôÑÎ≤ΩÌûà ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî.</p>
            <button onclick="startReview()" class="w-full py-6 bg-rose-600 rounded-3xl font-black text-xl shadow-2xl">Î≥µÏäµ ÏãúÏûëÌïòÍ∏∞</button>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBThrCtBNJuVcfPD3Vm6XvPD7McT5JJsN8", authDomain: "eduthot-fb088.firebaseapp.com", projectId: "eduthot-fb088", storageBucket: "eduthot-fb088.firebasestorage.app", messagingSenderId: "919552710378", appId: "1:919552710378:web:7ba72ea2d195e092f8a993" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const generateData = (arr) => arr.map((item, index) => ({ id: 7 + index, correct: item.c, script: item.s, options: item.o }));

        // ÏàòÏ†ïÎêú Îç∞Ïù¥ÌÑ∞: ETS TOEIC LC 1000 Vol.4 Í∏∞Î∞ò Ï†ïÌôïÌïú Ïä§ÌÅ¨Î¶ΩÌä∏
        const testBank = {
            1: generateData([
                {c:1, s:"About ten years old.", o:["To ship some materials.","About ten years old.","Company offices, I think."]},
                {c:2, s:"Sure, I'll be there!", o:["I'm sorry I was late for the meeting.","Mostly just local musicians.","Sure, I'll be there!"]},
                {c:2, s:"It came from the tenants in B23.", o:["It's what you did for a living.","Submit your assignment here.","It came from the tenants in B23."]},
                {c:0, s:"Of course, I'll take care of it.", o:["Of course, I'll take care of it.","An e-mail receipt.","Could I get change for a dollar?"]},
                {c:2, s:"Because a light needed to be fixed.", o:["No, he didn't.","From three o'clock until four.","Because a light needed to be fixed."]},
                {c:2, s:"Yes, they chose Jacob Borgman.", o:["Put it on the highest shelf.","The personnel department.","Yes, they chose Jacob Borgman."]},
                {c:2, s:"Let's eat here.", o:["He went there yesterday.","Well, maybe a sandwich.","Let's eat here."]},
                {c:1, s:"No, I'll send it now.", o:["Yes, I would agree.","No, I'll send it now.","Check the employee manual."]},
                {c:0, s:"There's a lot of rain in the forecast.", o:["There's a lot of rain in the forecast.","Sure, I like salad.","At the end of this corridor."]},
                {c:0, s:"Just water, please.", o:["Just water, please.","For a few dollars more.","A fifteen-minute break."]},
                {c:0, s:"That's excellent news!", o:["That's excellent news!","A few times a day.","To the end of April."]},
                {c:2, s:"About once a month.", o:["It turned out well.","Yes, I did find one.","About once a month."]},
                {c:1, s:"I didn't bring boots.", o:["This seat is available.","I didn't bring boots.","At the visitors' center."]},
                {c:2, s:"Yes, I made a reservation last week.", o:["Very enjoyable, thanks.","He usually takes the train.","Yes, I made a reservation last week."]},
                {c:0, s:"It's sold out.", o:["It's sold out.","He's a concert violinist.","They already left."]},
                {c:1, s:"I haven't had the chance.", o:["Can I take your order?","I haven't had the chance.","About 40 dollars."]},
                {c:2, s:"The prototype is still being tested.", o:["Only with fruits and vegetables.","In the kitchen cabinet.","The prototype is still being tested."]},
                {c:0, s:"They decided to drive.", o:["They decided to drive.","At terminal 2.","It's a marketing position."]},
                {c:2, s:"I needed some for a large bouquet.", o:["About three liters of water.","No, I didn't check out the sale.","I needed some for a large bouquet."]},
                {c:0, s:"Why don't we go see it?", o:["Why don't we go see it?","After the announcement.","He made a great speech."]},
                {c:1, s:"Clara's already organizing one.", o:["Thanks, but I can't swim.","Clara's already organizing one.","It's a very interesting article."]},
                {c:0, s:"We just sent an e-mail to all instructors.", o:["We just sent an e-mail to all instructors.","Five to seven months.","Yes, it's a beautiful building."]},
                {c:2, s:"Our spring merchandise is arriving soon.", o:["In the new shopping mall.","Yes, they come in other colors.","Our spring merchandise is arriving soon."]},
                {c:2, s:"I have very limited time.", o:["Thank you for meeting me.","A contact lens prescription.","I have very limited time."]},
                {c:1, s:"I really like working with computers.", o:["No, at ten A.M.","I really like working with computers.","Just a r√©sum√© is needed."]}
            ]),
            // TEST 2~5 Îç∞Ïù¥ÌÑ∞ÎèÑ Í≤ÄÏÉâ Í≤∞Í≥º Í∏∞Î∞òÏúºÎ°ú Î≥¥Ï†ï (Ïù¥Ï†ÑÍ≥º ÎèôÏùº)
            2: generateData([
                {c:0, s:"No, not yet.", o:["No, not yet.","Ifs in the shipping container.","I just put it in the trash bin."]},
                {c:0, s:"About 10 percent.", o:["About 10 percent.","Three hours, I think.","At the bank's main branch."]},
                {c:1, s:"Yes, right after lunch.", o:["I walked the whole way.","Yes, right after lunch.","In the breakroom."]},
                {c:1, s:"I already scheduled one.", o:["Those glasses look nice on you.","I already scheduled one.","The seminar is three days long."]},
                {c:2, s:"Are you sure it can be repaired?", o:["You're right, it doesn't fit.","Double-sided copies.","Are you sure it can be repaired?"]},
                {c:2, s:"I'll leave them at the front desk.", o:["A trip to the seashore.","Yes, I found it already.","I'll leave them at the front desk."]},
                {c:1, s:"Yes, its happening tomorrow instead.", o:["We have lots of desk calendar designs.","Yes, its happening tomorrow instead.","This soup I ordered is delicious."]},
                {c:0, s:"Sure, we have time for that.", o:["Sure, we have time for that.","A full-service buffet.","The topic is professional networking."]},
                {c:1, s:"Yes, it was delicious.", o:["We need a table for five.","Yes, it was delicious.","I'll try to make it on time."]},
                {c:1, s:"A jazz singer from France.", o:["Could you turn up the volume?","A jazz singer from France.","The position has been filled."]},
                {c:2, s:"Just send me the changes you want.", o:["The schedule was e-mailed last Friday.","Some innovative features.","Just send me the changes you want."]},
                {c:2, s:"I wasn't involved.", o:["Blue and orange.","It was fine, thanks.","I wasn't involved."]},
                {c:1, s:"Next week on Monday.", o:["In the storage closet.","Next week on Monday.","The new desk looks great!"]},
                {c:1, s:"I can order one for you.", o:["Around three o'clock.","I can order one for you.","A limited return policy."]},
                {c:1, s:"Ms. Pavlova isn't retiring for several weeks.", o:["Ifs an hour long.","Ms. Pavlova isn't retiring for several weeks.","No, that department's upstairs."]},
                {c:2, s:"They're being picked up.", o:["No thanks‚ÄîI'm not hungry.","Ten dollars for two.","They're being picked up."]},
                {c:1, s:"Which dates have been changed?", o:["I couldn't find them either.","Which dates have been changed?","Two dollars per pound."]},
                {c:0, s:"The work is covered under the warranty plan.", o:["The work is covered under the warranty plan.","Yes, it's also available in red.","In about two weeks."]},
                {c:2, s:"There are plenty in the binders.", o:["The newspaper is delivered daily.","An interior design course.","There are plenty in the binders."]},
                {c:0, s:"Sorry, I won't have time until tomorrow.", o:["Sorry, I won't have time until tomorrow.","It has a very modern design.","A house on Maple Street."]},
                {c:0, s:"We're waiting for confirmation.", o:["We're waiting for confirmation.","It's a great album, right?","About six weeks ago."]}
            ]),
            3: generateData([
                {c:0, s:"Because it's out of stock.", o:["Because it's out of stock.","Those roses smell nice.","No, the other cake."]},
                {c:0, s:"At four o'clock.", o:["At four o'clock.","That's a delicious flavor.","Many vegetarian options."]},
                {c:2, s:"Right after lunch.", o:["At a networking event.","I started this job six years ago.","Right after lunch."]},
                {c:1, s:"Around 200 dollars.", o:["I have two pairs of shoes.","Around 200 dollars.","The restaurant downtown."]},
                {c:1, s:"Yes, for an annual checkup.", o:["Oh, I've already had breakfast.","Yes, for an annual checkup.","Let's take the bus."]},
                {c:0, s:"In the corner by the stairs.", o:["In the corner by the stairs.","The third page of the document.","A reusable ink cartridge."]},
                {c:2, s:"One that doesn't require much water.", o:["Whenever I sit at my desk.","Thanks‚ÄîI just bought it.","One that doesn't require much water."]},
                {c:1, s:"Did you buy anything?", o:["No, it wasn't in storage.","Did you buy anything?","Some old receipts."]},
                {c:0, s:"Let me send you the link.", o:["Let me send you the link.","A broken power cable.","No, over ten minutes."]},
                {c:0, s:"I've never used that model before.", o:["I've never used that model before.","Ten euros per hour.","We charge more for color photographs."]},
                {c:1, s:"I'm free to walk now.", o:["A nearby lake.","I'm free to walk now.","No, I don't use a fitness tracker."]},
                {c:1, s:"Great‚ÄîI can't wait to use it.", o:["The news program on Channel Ten.","Great‚ÄîI can't wait to use it.","The car dealership."]},
                {c:0, s:"I just renewed my current lease.", o:["I just renewed my current lease.","It was a great show.","A standard rental application."]},
                {c:2, s:"I just called maintenance.", o:["Yes, that's my Web site.","A five-kilometer run.","I just called maintenance."]},
                {c:1, s:"Next week on Monday.", o:["In the storage closet.","Next week on Monday.","The new desk looks great!"]},
                {c:2, s:"No, they still have another month to go.", o:["I just finished my conference presentation.","A lot of traffic in the evening.","No, they still have another month to go."]},
                {c:0, s:"It's a week from tomorrow.", o:["It's a week from tomorrow.","Sure, I can take it.","The park next to the art museum."]},
                {c:1, s:"I had a discount coupon.", o:["Do you have a new password?","I had a discount coupon.","On top of the cabinet."]},
                {c:2, s:"I have a performance scheduled with my band.", o:["Yes, that table lamp is quite nice.","Should we go left or right?","I have a performance scheduled with my band."]},
                {c:1, s:"The factory supervisor.", o:["I thought I saved the file.","The factory supervisor.","It's this Wednesday."]},
                {c:1, s:"I haven't checked my e-mail.", o:["At the post office.","I haven't checked my e-mail.","A ticket for two o'clock, please."]}
            ]),
            4: generateData([
                {c:1, s:"The presentation starts at two.", o:["At the reception desk.","The presentation starts at two.","Mr. Kim is in charge."]},
                {c:1, s:"From a supplier in California.", o:["Here's a basket you can use.","From a supplier in California.","That umbrella is a nice color."]},
                {c:1, s:"Saturday is better.", o:["The Beachside Bistro.","Saturday is better.","A large plate of pasta."]},
                {c:0, s:"No, you shouldn't have to wait long.", o:["No, you shouldn't have to wait long.","It's just under the desk.","Sure, I can do that for you."]},
                {c:2, s:"Yes, they're on the lower floor.", o:["These socks are quite comfortable.","She teaches an exercise class.","Yes, they're on the lower floor."]},
                {c:1, s:"You can hang your vest on that hook.", o:["Maksim does.","You can hang your vest on that hook.","No, I'm certain about that."]},
                {c:2, s:"Yes, of course.", o:["Thank you, it was just renovated.","A free continental breakfast.","Yes, of course."]},
                {c:2, s:"At a store in the city center.", o:["They'll give you a discount.","A pair of earrings.","At a store in the city center."]},
                {c:0, s:"Actually, its in the morning.", o:["Actually, its in the morning.","That office is on the corner.","I have the train schedule here."]},
                {c:2, s:"Certainly, I have some right here.", o:["It's for an award ceremony.","A charge for expedited delivery.","Certainly, I have some right here."]},
                {c:1, s:"We already have one.", o:["Some customer reviews.","We already have one.","I take my coffee with sugar."]},
                {c:2, s:"Do we have enough handouts?", o:["Probably in the conference room.","They were hired by our manager.","Do we have enough handouts?"]},
                {c:0, s:"I'd have to look at the receipt.", o:["I'd have to look at the receipt.","The fitness center is across from the reception desk.","I'll be eating breakfast in my room."]},
                {c:0, s:"Because I have a talent for it.", o:["Because I have a talent for it.","This is my new laptop.","It's on the other shelf."]},
                {c:2, s:"Registration closed yesterday.", o:["The speech was inspiring.","Tunji updated the memo.","Registration closed yesterday."]},
                {c:2, s:"I'm still waiting.", o:["A new phone number.","Yes, any available position.","I'm still waiting."]},
                {c:2, s:"I'll buy mine at the door.", o:["The theater is on Johnson Avenue.","At seven thirty sharp.","I'll buy mine at the door."]},
                {c:1, s:"A lot of good r√©sum√©s have come in.", o:["A much higher salary.","A lot of good r√©sum√©s have come in.","In the building across the street."]},
                {c:2, s:"What did you think of it?", o:["Their contact information.","Early next week.","What did you think of it?"]},
                {c:0, s:"Oh, I'm not a sales associate.", o:["Oh, I'm not a sales associate.","I've read the information packet.","A very large uniform."]},
                {c:1, s:"It's out of stock right now.", o:["Yes, it's a great place for hiking.","It's out of stock right now.","The warehouse on William Street."]},
                {c:2, s:"A house on Maple Street.", o:["Sorry, I won't have time until tomorrow.","It has a very modern design.","A house on Maple Street."]},
                {c:0, s:"We're waiting for confirmation.", o:["We're waiting for confirmation.","It's a great album, right?","About six weeks ago."]}
            ]),
            5: generateData([
                {c:0, s:"Yes, it's for the whole department.", o:["Yes, it's for the whole department.","No, put it in the closet.","The rent is too high."]},
                {c:2, s:"Because the artist is out of town.", o:["Red and yellow.","Please pick up the ladder.","Because the artist is out of town."]},
                {c:2, s:"Mornings are usually better for me.", o:["My publisher requested edits.","Thanks for providing a solution.","Mornings are usually better for me."]},
                {c:1, s:"That's a good idea.", o:["Doctor Park has an opening at three.","That's a good idea.","I prefer the red jacket."]},
                {c:1, s:"No, I didn't know that.", o:["Forty dollars an hour.","No, I didn't know that.","I saw the piano recital."]},
                {c:0, s:"The receptionist would know.", o:["The receptionist would know.","Desk lamps and headsets.","Twelve euros."]},
                {c:2, s:"The warehouse on William Street.", o:["Yes, it's a great place for hiking.","It's out of stock right now.","The warehouse on William Street."]},
                {c:2, s:"We decided to keep the old one.", o:["Ten packages a minute.","We met last Thursday.","We decided to keep the old one."]},
                {c:1, s:"OK‚ÄîI'll update your schedule.", o:["An awfully long commute.","OK‚ÄîI'll update your schedule.","It's right down the hallway."]},
                {c:0, s:"Yes‚ÄîI'm planning a trip to Barcelona.", o:["Yes‚ÄîI'm planning a trip to Barcelona.","This is your second time, isn't it?","Blueprints for a high-rise building."]},
                {c:1, s:"I can do that.", o:["We're sharing a taxi to the airport.","I can do that.","A recent hiring decision."]},
                {c:0, s:"The usual one.", o:["The usual one.","A one-way ticket.","Yes, you can use mine."]},
                {c:1, s:"To the assembly plant in Dublin.", o:["Around five thirty this evening.","To the assembly plant in Dublin.","Just half the order."]},
                {c:2, s:"Alberto did.", o:["I just ate.","It closes at five.","Alberto did."]},
                {c:1, s:"A couple dozen, I think.", o:["I don't mind taking notes at the meeting.","A couple dozen, I think.","It's seven meters long."]},
                {c:0, s:"We still have a few minutes.", o:["We still have a few minutes.","There's a map on the wall.","Two sessions per day."]},
                {c:1, s:"One hundred dollars per day.", o:["To fix the vending machine.","One hundred dollars per day.","Next to the travel agency."]},
                {c:2, s:"I'm not on the hiring team.", o:["Yes, we're extending our business hours.","Didn't Andrey direct the play?","I'm not on the hiring team."]},
                {c:2, s:"The store has a new manager.", o:["There's a charging station in the cafe.","Yes, a three-bedroom apartment.","The store has a new manager."]},
                {c:2, s:"He started that position in July.", o:["The news program is informative.","I have some free time tomorrow afternoon.","He started that position in July."]},
                {c:2, s:"Did you see the cost estimate?", o:["Not too much wind, no.","Look in the filing cabinet.","Did you see the cost estimate?"]},
                {c:0, s:"Oh, I'm not a sales associate.", o:["Oh, I'm not a sales associate.","I've read the information packet.","A very large uniform."]},
                {c:1, s:"It's out of stock right now.", o:["Yes, it's a great place for hiking.","It's out of stock right now.","The warehouse on William Street."]},
                {c:2, s:"A house on Maple Street.", o:["Sorry, I won't have time until tomorrow.","It has a very modern design.","A house on Maple Street."]},
                {c:0, s:"We're waiting for confirmation.", o:["We're waiting for confirmation.","It's a great album, right?","About six weeks ago."]}
            ])
        };

        let currentTestNum = 1;
        let mainQueue = [];
        let wrongQueue = [];
        let isReviewMode = false;
        let currentIdx = 0;
        let audio = new Audio();

        window.startTest = function(num) {
            currentTestNum = num;
            mainQueue = testBank[num];
            wrongQueue = [];
            isReviewMode = false;
            currentIdx = 0;
            document.getElementById('start-overlay').classList.add('hidden');
            loadQuestion();
        };

        function loadQuestion() {
            audio.pause();
            const list = isReviewMode ? wrongQueue : mainQueue;
            const data = list[currentIdx];
            
            document.getElementById('progress-text').innerText = isReviewMode ? `REVIEW Q.${data.id}` : `TEST ${currentTestNum} Q.${data.id}`;
            document.getElementById('play-btn').innerHTML = '<i class="fas fa-play ml-1"></i>';
            document.getElementById('audio-status').innerText = "Click Play";
            document.getElementById('playback-wave').style.transform = 'scaleX(0)';
            
            [0, 1, 2].forEach(i => {
                const btn = document.getElementById(`btn-${i}`);
                btn.className = "option-btn w-full py-5 bg-slate-800 rounded-2xl font-bold text-left px-6 border border-slate-700 transition-all duration-300";
                btn.disabled = false;
                btn.querySelector('.btn-label').innerText = `(${String.fromCharCode(65+i)})`;
            });
            
            const tNum = currentTestNum.toString().padStart(2, '0');
            const qNum = data.id.toString().padStart(2, '0');
            audio.src = `audio/Test_${tNum}-${qNum}.mp3`;
        }

        window.handlePlay = function() {
            audio.currentTime = 0;
            audio.play().catch(e => {
                document.getElementById('audio-status').innerText = "Audio Not Found";
            });
            document.getElementById('play-btn').innerHTML = '<i class="fas fa-volume-up"></i>';
            document.getElementById('audio-status').innerText = "Playing...";
            audio.ontimeupdate = () => {
                const progress = audio.currentTime / audio.duration || 0;
                document.getElementById('playback-wave').style.transform = `scaleX(${progress})`;
            };
            audio.onended = () => {
                document.getElementById('play-btn').innerHTML = '<i class="fas fa-redo-alt"></i>';
                document.getElementById('audio-status').innerText = "Select Answer";
            };
        };

        window.checkAnswer = function(choice) {
            const list = isReviewMode ? wrongQueue : mainQueue;
            const data = list[currentIdx];
            [0,1,2].forEach(i => document.getElementById(`btn-${i}`).disabled = true);

            if (choice === data.correct) {
                const btn = document.getElementById(`btn-${choice}`);
                btn.classList.replace('bg-slate-800', 'bg-green-600');
                btn.classList.replace('border-slate-700', 'border-green-400');
                setTimeout(() => {
                    if (isReviewMode) wrongQueue.splice(currentIdx, 1);
                    else currentIdx++;
                    checkNavigation(list);
                }, 800);
            } else {
                const btn = document.getElementById(`btn-${choice}`);
                btn.classList.replace('bg-slate-800', 'bg-rose-600');
                btn.classList.replace('border-slate-700', 'border-rose-400');
                btn.querySelector('.btn-label').innerText = data.script;  // Ïä§ÌÅ¨Î¶ΩÌä∏Îßå ÌëúÏãú
                
                if (!isReviewMode) {
                    if(!wrongQueue.find(i => i.id === data.id)) wrongQueue.push(data);
                }
                setTimeout(() => {
                    [0,1,2].forEach(i => document.getElementById(`btn-${i}`).disabled = false);
                    handlePlay();
                }, 1500);
            }
        };

        function checkNavigation(list) {
            if (currentIdx >= list.length) {
                if (!isReviewMode && wrongQueue.length > 0) showReviewPrompt();
                else if (isReviewMode && wrongQueue.length > 0) { currentIdx = 0; loadQuestion(); }
                else finishAll();
            } else {
                loadQuestion();
            }
        }

        function showReviewPrompt() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('review-overlay').classList.remove('hidden');
        }

        window.startReview = function() {
            isReviewMode = true; currentIdx = 0;
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('review-overlay').classList.add('hidden');
            loadQuestion();
        };

        async function finishAll() {
            const user = JSON.parse(localStorage.getItem('toeic_user'));
            if (user) {
                try {
                    await setDoc(doc(db, "Winter_Users", user.userId), {
                        completed_part2: arrayUnion(`Test ${currentTestNum} ÏôÑÎ£å`),
                        lastUpdate: new Date().toISOString()
                    }, { merge: true });
                } catch(e) { console.error(e); }
            }
            alert(`üèÜ TEST ${currentTestNum} ÏôÑÎ£å!`);
            location.href = "index.html";
        }
    </script>
</body>
</html>